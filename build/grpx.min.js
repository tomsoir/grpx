(function(){!function(t,e){"object"==typeof exports?e(exports,require("jQuery")):"function"==typeof define&&define.amd?define(["exports","jQuery"],e):e(window,$)}(this,function(t,e){var o,r,n;return n={_getImageSrc:function(t,e){return"no"===String(t)?e+"/f/1/global/b/b-calculations/noimg.jpeg":e+"/r/"+t+"/1.jpg"},_formatPriceMatrix:function(t,e){var o,r,n,i,s,a,p,u,c;for(c=this.textsModule,u={selectedConditionStr:c[e],selectedCondition:e,groupCondition:{},selectedConditionGroup:{},otherConditionHeads:[],otherConditionGroup:[]},n=0,s=t.length;s>n;n++)p=t[n],u.groupCondition[p.cond]={way:{},name:p.cond,title:c[p.cond],selected:String(e)===String(p.cond)?!0:!1};for(i=0,a=t.length;a>i;i++)p=t[i],u.groupCondition[p.cond].way[p.way]=p.price;for(r in u.groupCondition)o=u.groupCondition[r],o.selected&&(u.selectedConditionGroup=o);for(r in u.groupCondition)o=u.groupCondition[r],o.selected||(u.otherConditionGroup.push(o),u.otherConditionHeads.push({name:o.name,title:o.title}));return u},_monthText:function(t){var e;switch(String(t)){case"1":e="Январь";break;case"2":e="Февраль";break;case"3":e="Март";break;case"4":e="Апрель";break;case"5":e="Май";break;case"6":e="Июнь";break;case"7":e="Июль";break;case"8":e="Август";break;case"9":e="Сентябрь";break;case"10":e="Октябрь";break;case"11":e="Ноябрь";break;case"12":e="Декабрь"}return e},_returnParam:function(t){return t?t:void 0},_getModifyByText:function(t){var e,o,r,n,i,s,a;for(a=this.textsModule,o=[],e=String(t).split("_"),i=0,s=e.length;s>i;i++)n=e[i],o.push(a[String(n).toLowerCase()]?a[String(n).toLowerCase()]:n);return r={},e=String(t).split("_"),{asArray:o,asGroup:{body:{title:a.body,value:a[String(e[0]).toLowerCase()]},engine_volume:{title:a.engine_volume,value:String(e[1]).replace(/^(.*)\(.*\)$/,"$1")},power:{title:a.power,value:String(e[1]).replace(/^.*\((.*)\)$/,"$1")},engine_type:{title:a.engine_type,value:e[2]},privod:{title:a.privod,value:e[3]},transmission:{title:a.transmission,value:e[4]}}}},_getBrandIconByMark:function(t,e,o){var r,n,i,s,a;for(s=String(t).toLowerCase().trim().replace(/(.+)\s.*/g,"$1"),a=e.brands,n=0,i=a.length;i>n;n++)r=a[n],r.id===s&&(e=r);return e?o+"/r/"+String(e.uuid).trim()+"/icon_"+String(e.file_name).trim():o+"/r/63806594-6C1E-4C56-BC4B-0E911E967BD4/icon_noimg.jpeg"},textsModule:{appType:{1:"справочник",2:"trade-In",3:"trade-In отправки заявки",4:"разработка внутри компании"},reportType:{1:"все расчеты и заявки",2:"партнерская статистика"},"внедорожник 3 door":"Внедорожник 3-х дверный","внедорожник 3 door (new)":"Внедорожник 3-х дверный (обновленный)","внедорожник 5 door":"Внедорожник 5-и дверный","внедорожник 5 door (new)":"Внедорожник 5-и дверный (обновленный)","кабриолет":"Кабриолет","кабриолет (new)":"Кабриолет (обновленный)","купе":"Купе","купе (new)":"Купе (обновленный)","минивэн":"Минивэн","минивэн (new)":"Минивэн (обновленный)","пикап":"Пикап","пикап (new)":"Пикап (обновленный)","родстер":"Родстер","родстер (new)":"Родстер (обновленный)","седан":"Седан","седан (new)":"Седан (обновленный)","универсал":"Универсал","универсал (new)":"Универсал (обновленный)","хэтчбек 3 door":"Хэтчбек 3-х дверный","хэтчбек 3 door (new)":"Хэтчбек 3-х дверный (обновленный)","хэтчбек 5 door":"Хэтчбек 5-и дверный","хэтчбек 5 door (new)":"Хэтчбек 5-и дверный (обновленный)",userGuidText:"Мы сохраняем 10 последних сделанных вами расчетов.",headerSubText:"Возможности вашего личного кабинета могут быть увеличены.",yes:"Да",no:"Нет",normal:"Нормальное",good:"Хорошее",excellent:"Превосходное",owners:"Владелец",color:"Цвет кузова",ckeys:"Количество ключей",condition:"Состояние автомобиля",genuine_docs:"Наличие документов",s_color:"Цвет салона",sbook:"Наличие сервисной книжки",aerography:"Аэрография",body:"Кузов",engine_volume:"Объем двигателя",power:"Мощность",engine_type:"Тип двигателя",privod:"Привод",transmission:"Коробка передач"}},r=function(){function t(t,e){this.GRPX=t,this.staticHost=t.config.staticHost,this.options=e}return t.prototype.minimalOptions=["year","mid","cmid","agemonths","grp0","grp1","grp2","grp3","grp4","grp5","grp6","grp7","mileage","version"],t.prototype.model={details:void 0,price:void 0,brands:void 0},t.prototype.getData=function(){var t;return t=e.Deferred(),this._checkOptions(t)&&this.GRPX._onload(arguments,function(e){return function(){return e._getRequireData().done(function(){return t.resolve(e._prepareResultData())})}}(this)),t},t.prototype._getRequireData=function(){var t,o;return o=e.Deferred(),t=function(t){return function(){return t.model.details&&t.model.price&&t.model.brands?o.resolve():void 0}}(this),this.model.details||this._sendRequest("get_full_details").done(function(e){return function(o){return e.model.details=o[0],t()}}(this)),this.model.price||this._sendRequest("get_calculation").done(function(e){return function(o){return e.model.price=o,t()}}(this)),this.model.brands||this._sendRequest("get_brands").done(function(e){return function(o){return e.model.brands=o,t()}}(this)),t(),o},t.prototype._sendRequest=function(t){var e;switch(t){case"get_full_details":return e=["year="+this.options.year,"mid="+this.options.mid,"cmid="+this.options.cmid,"version="+this.options.version],this.GRPX.createRequest("get_full_details",e.join("&")+"&");case"get_calculation":return e=["year="+this.options.year,"mid="+this.options.mid,"cmid="+this.options.cmid,"version="+this.options.version,"agemonths="+this.options.agemonths,"mileage="+this.options.mileage,"grp0="+this.options.grp0,"grp1="+this.options.grp1,"grp2="+this.options.grp2,"grp3="+this.options.grp3,"grp4="+this.options.grp4,"grp5="+this.options.grp5,"grp6="+this.options.grp6,"grp7="+this.options.grp7,"country="+(this.options.country?this.options.country:"RU"),"province="+(this.options.province?this.options.province:"47")],this.GRPX.createRequest("get_calculation",e.join("&")+"&");case"get_brands":return this.GRPX.createRequest("get_brands")}},t.prototype._checkOptions=function(t){var e,o,r,n,i;if(i=!1,this.options){for(n=this.minimalOptions,e=0,o=n.length;o>e;e++)r=n[e],"undefined"==typeof this.options[r]&&(i=!1);i=!0}return i||(console.error("minimal options missing: "+this.minimalOptions.join(", ")),t.reject()),i},t.prototype._prepareResultData=function(){var t;return t=null!=this.model.details.gallery?this.model.details.gallery:"no",{image:n._getImageSrc(t,this.staticHost),price:n._formatPriceMatrix(this.model.price.price,this.model.price.selected_condition),date:{yearProduction:this.options.year,yearRegistration:this.options.year,monthRegistration:1,monthRegistrationStr:n._monthText(1)},make:this.model.details.make,makeIcon:n._getBrandIconByMark(this.model.details.make,this.model,this.staticHost),model:this.model.details.model,modify:n._getModifyByText(this.model.details.mod_name),compllectation:{base:n._returnParam(this.model.details.compl_base_name),name:n._returnParam(this.model.details.compl_name),full:this.model.details.compl_base_name?this.model.details.compl_name+" ("+this.model.details.compl_base_name+")":this.model.details.compl_name},mileage:this.options.mileage,version:this.options.version,agemonths:this.options.agemonths,gallery:this.model.details.gallery}},t}(),o=function(){function t(){this._jqueryReady()&&this.requiresReady()}return t.prototype.ready=!1,t.prototype.ver=void 0,t.prototype.desc=void 0,t.prototype.sect=void 0,t.prototype.config={staticHost:"http://correctprice.ru",masterApi:"http://api.correctprice.ru",backupApi:"http://api2.correctprice.ru"},t.prototype._jqueryReady=function(){return e.isReady?!0:(console.error("jQuery not ready. Placed this call into $(function{ ... })"),!1)},t.prototype.createRequest=function(t,o){var r;return r=e.Deferred(),o=o?o:"",e.ajax({url:this.config.masterApi+"/"+t+"?"+o+this._getVersion(o)+"jsoncallback=?",timeout:3e3,dataType:"json",success:function(){return function(t){return null!=t?r.resolve(t):void 0}}(this),error:function(e){return function(){return e.config.masterApi!==e.config.backupApi?(e.config.masterApi=e.config.backupApi,e.createRequest(t,o)):console.error("Error plugin Correct Price api service")}}(this)}),r},t.prototype.requiresReady=function(){return this._readyState=e.Deferred(),this._requestVersion().done(function(t){return function(){var e;return t.desc||t.sect?t._readyState.resolve():(e=function(){return t.desc&&t.sect?(t.ready=!0,t._readyState.resolve()):void 0},t.createRequest("get_opt_desc").done(function(o){return t.desc=o,e()}),t.createRequest("get_opt_sect").done(function(o){return t.sect=o,e()}))}}(this)),this._readyState},t.prototype._changeVersionData=function(t){return this.ver=t,this.desc=void 0,this.sect=void 0,this.requiresReady()},t.prototype._requestVersion=function(){var t;return t=e.Deferred(),this.ver?t.resolve():this.createRequest("get_version").done(function(e){return function(o){return e.ver=o.version,t.resolve()}}(this)),t},t.prototype._getVersion=function(t){var e,o;return o="",e=new RegExp("version","g"),null!=this.ver&&(o="version="+this.ver+"&"),null!=t&&e.test(t)&&(o=""),o},t.prototype._onload=function(t,o){var r,n;return this._jqueryReady()?(r=this,n=e.Deferred(),this._readyState.done(function(){var e;return e=o.apply(r,t),n.resolve(e)}),n):{done:function(){return!1}}},t.prototype.version=function(){return this.ver},t.prototype.pack=function(t,o){var r,n;return null!=o&&o!==this.ver?(n=e.Deferred(),r=arguments,this._changeVersionData(o).done(function(t){return function(){return t._onload(r,t._pack).done(function(t){return n.resolve(t)})}}(this))):n=this._onload(arguments,this._pack),n},t.prototype._pack=function(t){var o,r,n,i,s,a;return n=this.desc,i=this.sect,r={},o=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],e(n).each(function(e,r){return"undefined"!=typeof t[r.catg]&&t[r.catg]===r.name?o[r.grp][r.pos>31?1:0]+=Math.pow(2,r.pos>31?r.pos-32:r.pos):void 0}),a=function(t){for(;t.length>1&&"0"===t.substr(0,1);)t=t.substr(1);return t},e(o).each(function(t,e){return e[1]=a(e[1].toString(16)+("00000000"+e[0].toString(16)).substr(-8)),e[0]="grp"+t}),s="grp0="+o[0][1]+"&grp1="+o[1][1]+"&grp2="+o[2][1]+"&grp3="+o[3][1]+"&grp4="+o[4][1]+"&grp5="+o[5][1]+"&grp6="+o[6][1]+"&grp7="+o[7][1],r.url=s,r.obj={grp0:o[0][1],grp1:o[1][1],grp2:o[2][1],grp3:o[3][1],grp4:o[4][1],grp5:o[5][1],grp6:o[6][1],grp7:o[7][1]},r},t.prototype.unpack=function(t,o){var r,n;return null!=o&&o!==this.ver?(n=e.Deferred(),r=arguments,this._changeVersionData(o).done(function(t){return function(){return t._onload(r,t._unpack).done(function(t){return n.resolve(t)})}}(this))):n=this._onload(arguments,this._unpack),n},t.prototype._unpack=function(t){var o,r,n,i,s,a;return i=this.desc,s=this.sect,r=t,a={},o=[],n="",e(s).each(function(t,e){var r,i,s,p;if(a[e.catg]=e.sect,n!==e.sect){for(n=e.sect,r=!1,i=0,p=o.length;p>i;i++)s=o[i],s===n&&(r=!0);if(!r)return o.push(n)}}),e(r).each(function(t,o){return o.options={},e(i).each(function(t,e){var r,n,i;return n=o["grp"+e.grp],r=Math.ceil(n.length-e.pos/4-1),parseInt("0x"+n.substring(r,r+1))&Math.pow(2,e.pos%4)?(i=a[e.catg],void 0===o.options[i]&&(o.options[i]={}),void 0===o.options[i][e.catg]?o.options[i][e.catg]=e.name:o.options[i][e.catg]instanceof Array?o.options[i][e.catg].push(e.name):o.options[i][e.catg]=[o.options[i][e.catg],e.name]):void 0})}),r.options},t.prototype.unpackToDefault=function(){return this._onload(arguments,this._unpackToDefault)},t.prototype._unpackToDefault=function(t){var e,o,r,n;n={},e=this._unpack(t);for(o in e)for(r in e[o])n[r]=e[o][r][0];return n},t.prototype._extendIncomingToDefault=function(t,e){var o;for(o in e)t[o]?t[o]=e[o]:console.error("Can't find param with name: "+o);return t},t.prototype.packWithDefault=function(){return this._onload(arguments,this._packWithDefault)},t.prototype._packWithDefault=function(t,e){var o,r,n;return o=this._unpackToDefault(e),n=this._extendIncomingToDefault(o,t),r=this._pack(n)},t.prototype.getFullDetales=function(t){return null==this._printClass&&(this._printClass=new r(this,t)),this._printClass.getData()},t}(),t.$GRPX||(t.$GRPX=o),o})}).call(this);
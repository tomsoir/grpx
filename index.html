<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="chrome=1">
        <title>Grpx by tomsoir</title>

        <link rel="stylesheet" href="stylesheets/styles.css">
        <link rel="stylesheet" href="stylesheets/pygment_trac.css">
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script type="text/javascript" src="dev/grpx.js"></script>
        <!--<script type="text/javascript" src="javascripts/dev/grpx.js"></script>-->
        <!--[if lt IE 9]>
        <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
    </head>
<body>
    <div class="wrapper">

        <header>
            <h1>GRPX lib <sub>v0.1.1</sub></h1>
            <p>GRPX-конвертор бинарных векторов проекта <a href="http://correctprice.ru/">Correct Price</a></p>
            <p class="view"><a href="https://github.com/tomsoir/grpx">Проект на GitHub <small style="padding-top:5px;">tomsoir/grpx</small></a></p>
            <ul>
              <li><a href="https://github.com/tomsoir/grpx/zipball/master">Download <strong>ZIP File</strong></a></li>
              <li><a href="https://github.com/tomsoir/grpx/tarball/master">Download <strong>TAR Ball</strong></a></li>
              <li><a href="https://github.com/tomsoir/grpx">View On <strong>GitHub</strong></a></li>
            </ul>
        </header>


        <section>
            <div>
                <h1><a class="anchor" aria-hidden="true" 
                    id="main" 
                    href="#main">
                    Спецификация и подключение
                </a></h1>
                <p>GRPX lib - JavaScript-библиотека, разработанная для сопровождения GRPX бинарных векторов, используемых в компании <a href="http://correctprice.ru">Correct Price "Правильная цена"</a>, и позволяющих преобразовывать и передавать данные в компактном виде.</p>


                <h3><a class="anchor" aria-hidden="true" 
                    id="requires" 
                    href="#requires">
                    Зависимости и ограничения:
                </a></h3>
                <p>Перед использованием, убедитесь что выполняются ниже следующие зависимости:</p>
                <ul>
                    <li>
                        <b>Доступ к глобальной области видимости (window/document)</b>
                        <br >Допускается использование GRPX lib библиотек как в качестве импортирования в глобальную область видимости переменных так и в качестве AMD-модуля, возвращаемого объект класса.
                    </li>
                    <li>
                        <b>http — протокол</b>
                        <br>https по отдельному запросу
                    </li>
                    <li>
                        <b>JQuery — не ниже версии 1.9.0.</b>
                        <br>GRPX lib библиотека должна быть проинициализирована непосредственно после инициализации JQuery
                        <br>Используемые JQuery-компоненты в GRPX lib библиотеке:
                        <ol>
                            <li>$.ajax</li>
                            <li>$.Deferred</li>
                        </ol>
                    </li>
                </ul>


                <h3><a class="anchor" aria-hidden="true" 
                    id="requires" 
                    href="#requires">
                    Подключение и инициализация:
                </a></h3>
                <ul>
                    <li>Скопируйте файл библиотеки из <a href="https://github.com/tomsoir/grpx">репозитория проекта на GitHub</a></li>
                    <li>Добавьте вызов скрипта библиотеки между тегами HEAD. <br/>Например:
<pre><code>&lt;html>
    &lt;head>
        &lt;script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js">&lt;/script>
        &lt;script type="text/javascript" src="grpx.min.js">&lt;/script>
    &lt;/head>
    &lt;body> ... &lt;/body>
&lt;/html>
</code></pre>
                    </li>
                    <li>После подключения файла для:
                        <ol>
                            <li>Глобальной области видимости будет доступен класс
<pre><code>window.$GRPX</code></pre>
                            </li>
                            <li>Использования в качестве AMD-модуля так же будет доступен класс с указанным при вызове модуля названием</li>
                        </ol>
                    </li>
                    <li>
                        Инициализация библиотеки произойдет сразу после создания экземпляра класса:
<pre><code>&lt;script>
    // инициализация JQuery
    $(function(){
        // инициализация GRPX lib библиотеки
        window.grpxlib = new $GRPX;

        // пример вызова методов
        grpxlib.pack({
            "condition": "excellent",
        }).done(function(result){
            console.log('pack >>', result);
        });
    })
&lt;/script>
</code></pre>
                    </li>
                    <li>Всё. В дальнейшем можно использовать объект grpxlib (или window.grpxlib) и его методы для работы с данными GRPX-векторов</li>
                </ul>
            </div>






            <script>
                $(function(){
                    window.grpxlib = new $GRPX;

                    // fast example 1
                    grpxlib.pack({
                        "condition": "excellent",
                        "Лобовое стекло с подогревом": "Да",
                        "sbook": "yes",
                        "ckeys": "1"
                    }).done(function(result){
                        console.log('pack >>', result);
                    });

                    // fast example 2
                    grpxlib.pack({
                        "condition": "excellent",
                    }).done(function(result){
                        console.log('pack >>', result);
                    });

                    // fast example 3

                    grpxlib.getFullDetales({
                        "year":"2009",
                        "mid":"1821",
                        "cmid":"6198",
                        "agemonths":"67",
                        "grp0":"100000000000000",
                        "grp1":"200000008000000",
                        "grp2":"4200008004008001",
                        "grp3":"20004111000041",
                        "grp4":"0",
                        "grp5":"0",
                        "grp6":"0",
                        "grp7":"0",
                        "mileage":"73000",
                        "maid":"AvOnTlSd4bxmS_mfIvJpuVqJhmn0YtBe",
                        "version":"1420333135"
                    }).done(function(result){
                        console.log('getFullDetales >>', result);
                    });

                });

                visualizeCode = function(obj, type){
                    // console.log('>>>', obj);
                    resultHTML = '<i>Ошибка введенных данных</i>'

                    if(obj){
                        switch (type) {
                            case 'unpack': 
                                var groupHTML = '';
                                for(groupName in obj){
                                    var itemHTML = '';
                                    groupHTML += '<li>'+groupName+'<ul>';
                                    for(itemName in obj[groupName]){
                                        itemHTML += '<li><b>'+itemName+'</b>: <span>'+obj[groupName][itemName]+'</span></li>';
                                    }
                                    groupHTML += itemHTML+'</ul></li>'
                                }
                                resultHTML = '<ul class="dataTree">'+groupHTML+'</ul>';
                                break

                            case 'pack':
                                var groupHTML = '';
                                for(groupName in obj.obj){
                                    groupHTML += '<li>'+groupName+': '+obj.obj[groupName]+'</li>';
                                }
                                resultHTML = '<ul class="dataTree">'+groupHTML+'</ul>';
                                break

                            case 'unpackDefault':
                                var groupHTML = '';
                                for(groupName in obj){
                                    groupHTML += '<li>'+groupName+': '+obj[groupName]+'</li>';
                                }
                                resultHTML = '<ul class="dataTree">'+groupHTML+'</ul>';
                                break

                            case 'fullDetales':
                        }
                    }

                    return resultHTML
                }
            </script>







            <div>
                <h1><a class="anchor" aria-hidden="true" 
                    id="methods" 
                    href="#methods">
                    Основные методы с примерами
                </a></h1>





                <!-- version -->
                <h3><a class="anchor" aria-hidden="true" 
                    id="version-method" 
                    href="#version-method">
                    version
                </a></h3>
                <div class="desc">
                    <div><b>Описание:</b> Возвращает последнюю версию данных</div>
                    <div><b>Нет параметров на вход</b></div>
                    <div><b>Ответ: String</b> 
                </div>

                <form id="version-form">
                    <table class="example">
                        <tr><th>Входные данные</th><th>Результат</th></tr>
                        <tr><td>&nbsp;</td><td><div class="output"></div></td></tr>
                        <tr><td colspan="2"><input value="Запросить последнюю версию" type="submit"/></td></tr>
                    </table>
                    <script>
                        $(function(){
                            $('#version-form').on('submit', function(){
                                var $resultwrap = $(this).find('.output');
                                var $submit     = $(this).find('[type=submit]');

                                version = grpxlib.version()

                                $resultwrap.html( version );
                                // show in console.log
                                console.log('VERSION', '\n out:', version );
                                // show note
                                if(!$submit.next().length){ $submit.after('<i>результат доступен в <b>console.log</b></i>') }

                                return false;
                            });
                        });
                    </script>
                </form>
                <!-- /version -->








                <!-- pack -->
                <h3><a class="anchor" aria-hidden="true" 
                    id="pack-method" 
                    href="#pack-method">
                    pack
                </a></h3>
                <div class="desc">
                    <div><b>Описание:</b> Запаковка данных в GRPX вектор</div>
                    <div><b>На вход: 2 параметр</b> 
                        <ul>
                            <li>(обязательный) js-объект с данными</li>
                            <li>(не обязательный) версия данных. По умолчанию берется последняя версия</li>
                        </ul>
                    </div>
                    <div><b>Ответ: $.Deferred - объект</b> 
                </div>

                <form id="pack-form">
                    <table class="example">
                        <tr><th>Входные данные</th><th>Результат</th></tr>
                        <tr><td>
<textarea rows="10">{
    "condition": "excellent",
    "Лобовое стекло с подогревом": "Да",
    "sbook": "yes",
    "ckeys": "1"
}</textarea>
<label>Версия данных: <input type="text" value=""/></label>
                        </td><td><div class="output"></div></td></tr>
                        <tr><td colspan="2"><input value="Запакова данные в вектор" type="submit"/></td></tr>
                    </table>
                    <script>
                        $(function(){
                            $('#pack-form').on('submit', function(){
                                var $textarea   = $(this).find('textarea');
                                var $resultwrap = $(this).find('.output');
                                var $submit     = $(this).find('[type=submit]');

                                var $input      = $(this).find('[type=text]');
                                if(!$input.val().length){ $input.val(grpxlib.version()) }

                                var inputData   = ''
                                try{ inputData  = jQuery.parseJSON( $textarea.val() ) }catch(e){ console.log(e) }

                                // '1420333135'
                                grpxlib.pack(inputData, $input.val()).done(function(result){
                                    // show result
                                    $resultwrap.html( visualizeCode(result, 'pack') );
                                    // show in console.log
                                    console.log('PACK', '\n in:', inputData,'\n out:', result );
                                    // show note
                                    if(!$submit.next().length){ $submit.after('<i>результат доступен в <b>console.log</b></i>') }
                                });

                                return false;
                            });
                        });
                    </script>
                </form>
                <!-- /pack -->





                <!-- unpack -->
                <h3><a class="anchor" aria-hidden="true" 
                    id="unpack-method" 
                    href="#unpack-method">
                    unpack
                </a></h3>
                <div class="desc">
                    <div><b>Описание:</b> Распаковка GRPX вектора со всеми переданными значениями</div>
                    <div><u>Внимание!</u> Первое значение в массива является значением по-умолчанию для данной опции</div>

                    <div><b>На вход: 1 параметр</b> 
                        <ul>
                            <li>(обязательный) js-объект с набором GRPX-векторов</li>
                            <li>(не обязательный) версия данных. По-умолчанию берется последняя версия</li>
                        </ul>
                    </div>
                    <div><b>Ответ: $.Deferred объект</b> 
                </div>

                <form id="unpack-form">
                    <table class="example">
                        <tr><th>Входные данные</th><th>Результат</th></tr>
                        <tr><td>
<textarea rows="10">{
    "grp0":"0",
    "grp1":"FFE8000000000000",
    "grp2":"1FFDFFFFFFFFFC29",
    "grp3":"FFFF333C03FD1C7F",
    "grp4":"F33F3",
    "grp5":"0",
    "grp6":"0",
    "grp7":"0"
}</textarea>
<label>Версия данных: <input type="text" value=""/></label>
                        </td><td><div class="output"></div></td></tr>
                        <tr><td colspan="2"><input value="Распакова вектор" type="submit"/></td></tr>
                    </table>
                    <script>
                        $(function(){
                            $('#unpack-form').on('submit', function(){
                                var $textarea   = $(this).find('textarea');
                                var $resultwrap = $(this).find('.output');
                                var $submit     = $(this).find('[type=submit]');

                                var $input      = $(this).find('[type=text]');
                                if(!$input.val().length){ $input.val(grpxlib.version()) }

                                var inputData   = ''
                                try{ inputData  = jQuery.parseJSON( $textarea.val() ) }catch(e){ console.log(e) }


                                grpxlib.unpack(inputData, $input.val()).done(function(result){
                                    // show result
                                    $resultwrap.html( visualizeCode(result, 'unpack') );
                                    // show in console.log
                                    console.log('UNPACK', '\n in:', inputData,'\n out:', result );
                                    // show note
                                    if(!$submit.next().length){ $submit.after('<i>результат доступен в <b>console.log</b></i>') }
                                });

                                return false;
                            });
                        });
                    </script>
                </form>
                <!-- /unpack -->








                <!-- unpackToDefault -->
                <h3><a class="anchor" aria-hidden="true" 
                    id="unpackToDefault-method" 
                    href="#unpackToDefault-method">
                    unpackToDefault
                </a></h3>
                <div class="desc">
                    <div><b>Описание:</b> Распаковка GRPX вектора имеющего опции с массивом значений, и автоматическим выбором значений по-умолчанию для каждой опции</div>
                    <div><b>На вход: 1 параметр</b> 
                        <ul>
                            <li>js-объект с набором GRPX-векторов</li>
                        </ul>
                    </div>
                    <div><b>Ответ: $.Deferred объект</b> 
                </div>

                <form id="unpackToDefault-form">
                    <table class="example">
                        <tr><th>Входные данные</th><th>Результат</th></tr>
                        <tr><td>
<textarea rows="10">{
    "grp0":"0",
    "grp1":"FFE8000000000000",
    "grp2":"1FFDFFFFFFFFFC29",
    "grp3":"FFFF333C03FD1C7F",
    "grp4":"F33F3",
    "grp5":"0",
    "grp6":"0",
    "grp7":"0"
}</textarea>
                        </td><td><div class="output"></div></td></tr>
                        <tr><td colspan="2"><input value="Распакова вектор" type="submit"/></td></tr>
                    </table>
                    <script>
                        $(function(){
                            $('#unpackToDefault-form').on('submit', function(){
                                var $textarea   = $(this).find('textarea');
                                var $resultwrap = $(this).find('.output');
                                var $submit     = $(this).find('[type=submit]');

                                var inputData   = ''
                                try{ inputData  = jQuery.parseJSON( $textarea.val() ) }catch(e){ console.log(e) }

                                grpxlib.unpackToDefault(inputData).done(function(result){
                                    // show result
                                    $resultwrap.html( visualizeCode(result, 'unpackDefault') );
                                    // show in console.log
                                    console.log('UNPACK DEFAULT', '\n in:', inputData,'\n out:', result );
                                    // show note
                                    if(!$submit.next().length){ $submit.after('<i>результат доступен в <b>console.log</b></i>') }
                                });

                                return false;
                            });
                        });
                    </script>
                </form>
                <!-- /unpackToDefault -->









                <!-- packWithDefault -->
                <h3><a class="anchor" aria-hidden="true" 
                    id="packWithDefault-method" 
                    href="#packWithDefault-method">
                    packWithDefault
                </a></h3>
                <div class="desc">
                    <div><b>Описание:</b> Запаковка GRPX вектора имеющего опции с массивом значений, и автоматическим выбором значений по-умолчанию для каждой опции</div>
                    <div><b>На вход: 2 параметра</b> 
                        <ul>
                            <li>js-объект с опциями и значениями которые нужно заменить в значениях выбранных по умолчанию</li>
                            <li>js-объект с набором GRPX-векторов</li>
                        </ul>
                    </div>
                    <div><b>Ответ: $.Deferred объект</b> 
                </div>

                <form id="packWithDefault-form">
                    <table class="example">
                        <tr><th>Входные данные</th><th>Результат</th></tr>
                        <tr><td>
<textarea rows="6">{
    "condition": "excellent",
    "Лобовое стекло с подогревом": "Да",
    "sbook": "yes",
    "ckeys": "1"
}</textarea>

<textarea rows="10">{
    "grp0":"0",
    "grp1":"FFE8000000000000",
    "grp2":"1FFDFFFFFFFFFC29",
    "grp3":"FFFF333C03FD1C7F",
    "grp4":"F33F3",
    "grp5":"0",
    "grp6":"0",
    "grp7":"0"
}</textarea>
                        </td><td><div class="output"></div></td></tr>
                        <tr><td colspan="2"><input value="Запакова вектор" type="submit"/></td></tr>
                    </table>
                    <script>
                        $(function(){
                            $('#packWithDefault-form').on('submit', function(){
                                var $textarea1  = $($(this).find('textarea')[0]);
                                var $textarea2  = $($(this).find('textarea')[1]);
                                var $resultwrap = $(this).find('.output');
                                var $submit     = $(this).find('[type=submit]');

                                var inputData1  = ''
                                var inputData2  = ''
                                try{ inputData1 = jQuery.parseJSON( $textarea1.val() ) }catch(e){ console.log(e) }
                                try{ inputData2 = jQuery.parseJSON( $textarea2.val() ) }catch(e){ console.log(e) }
                                

                                grpxlib.packWithDefault(inputData1, inputData2).done(function(result){
                                    // show result
                                    $resultwrap.html( visualizeCode(result, 'pack') );
                                    // show in console.log result
                                    console.log('PACK WITH DEFAULT', '\n in:', inputData1, '\n in:', inputData2, '\n out:', result );
                                    // show in console.log unpack default
                                    grpxlib.unpackToDefault(inputData2).done(function(result){
                                        console.log('unpack default:', result)
                                    });
                                    // show in console.log unpack result
                                    grpxlib.unpack(result.obj).done(function(result){
                                        console.log('unpack result:', result)
                                    });
                                    // show note
                                    if(!$submit.next().length){ $submit.after('<i>результат доступен в <b>console.log</b></i>') }
                                });

                                return false;
                            });
                        });
                    </script>
                </form>
                <!-- /packWithDefault -->




                <!-- getFullDetales -->
                <h3><a class="anchor" aria-hidden="true" 
                    id="getFullDetales-method" 
                    href="#getFullDetales-method">
                    getFullDetales
                </a></h3>
                <div class="desc">
                    <div><b>Описание:</b> Получение полных деталей сделанного расчета</div>
                    <div><b>На вход: 1 параметр</b> 
                        <ul>
                            <li>js-объект с опциями

                                <ol>
                                    <li>year</li>
                                    <li>mid</li>
                                    <li>cmid</li>
                                    <li>agemonths</li>
                                    <li>grpx</li>
                                    <li>mileage</li>
                                    <li>maid</li>
                                    <li>version</li>
                                </ol>
                            </li>
                        </ul>
                    </div>
                    <div><b>Ответ: $.Deferred объект</b> </div>
                    <div><b>Пример:</b> 
                        <a href="http://correctprice.ru/apps/calculation/?year=2009&mid=1821&cmid=6198&agemonths=67&grp0=100000000000000&grp1=200000008000000&grp2=4200008004008001&grp3=20004111000041&grp4=0&grp5=0&grp6=0&grp7=0&mileage=73000&maid=AvOnTlSd4bxmS_mfIvJpuVqJhmn0YtBe&version=1420333135">Принт-версия расчета</a>
                    </div>
                </div>

                <form id="getFullDetales-form">
                    <table class="example">
                        <tr><th>Входные данные</th><th>Результат</th></tr>
                        <tr><td>
<textarea rows="20">{
    "year":"2009",
    "mid":"1821",
    "cmid":"6198",
    "agemonths":"67",
    "grp0":"100000000000000",
    "grp1":"200000008000000",
    "grp2":"4200008004008001",
    "grp3":"20004111000041",
    "grp4":"0",
    "grp5":"0",
    "grp6":"0",
    "grp7":"0",
    "mileage":"73000",
    "maid":"AvOnTlSd4bxmS_mfIvJpuVqJhmn0YtBe",
    "version":"1420333135"
}</textarea>

                        </td><td><div class="output"></div></td></tr>
                        <tr><td colspan="2"><input value="Получить детали расчета" type="submit"/></td></tr>
                    </table>
                    <script>
                        $(function(){
                            $('#getFullDetales-form').on('submit', function(){
                                var $textarea   = $(this).find('textarea');
                                var $resultwrap = $(this).find('.output');
                                var $submit     = $(this).find('[type=submit]');

                                var inputData  = '';
                                try{ inputData = jQuery.parseJSON( $textarea.val() ) }catch(e){ console.log(e) };

                                grpxlib.getFullDetales(inputData).done(function(result){
                                    // show result
                                    $resultwrap.html( visualizeCode(result, 'unpackDefault') );
                                    // show in console.log result
                                    console.log('GET FULL DETALES', '\n in:', inputData, '\n out:', result );
                                    // show note
                                    if(!$submit.next().length){ $submit.after('<i>результат доступен в <b>console.log</b></i>') }
                                });

                                return false;
                            });
                        });
                    </script>
                </form>

                <!-- /getFullDetales -->




      </section>
      <footer>
        <p><a href="http://correctprice.ru/"><img src="images/correctprice_logo_dev.jpg" alt="correctprice logo" /></a></p>
        <p><small><a href="http://correctprice.ru/">Correct price</a>. Ваш собственный online-отдел профессиональной аналитики. &copy; 2015 г.</small></p>
        <!-- <p><small>Репозиторий проекта представлен разработчиком компании Correct Price, <a href="https://github.com/tomsoir">Artem Tkachenko</a>. &copy; 2015 г.</small></p> -->
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>

</body></html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
        <script type="text/javascript" src="grpx-lib.js"></script>
    </head>
<body>


<h2>Convertor GRP</h2>


<form id="grpxUnpackUrl">
    <h3>1) Unpack URL String</h3>
    <lable>Insert url string: <input type="text" name="grp" /></lable><br/><br/>
    <div>
        <span style="float: left">example:&nbsp;</span>
        <textarea>http://api.correctprice.ru/get_calculation?year=2006&mid=4962&cmid=13333&agemonths=107&grp0=0&grp1=1000000000&grp2=400410408001&grp3=2000822200008248&grp4=0&grp5=0&grp6=0&grp7=0&mileage=30000&host=correctprice.ru&country=RU&province=47&maid=JsEb6B0uMrYU4zkkbq8KOmCjOnTJ_ps0&version=1421637254</textarea>
    </div>
    <p style="display:none;"><i style="color:red">look at dev tool console.log </i></p>
    <button>Unpack</button>
</form>


<br><hr><br>


<form id="grpxUnpackChunk">
    <h3>2) Unpack grp chunks</h3>
    <ul>
        <li><lable>grp0 <input type="text" name="grp0" value="0" /></lable>                 example: 0 </li>
        <li><lable>grp1 <input type="text" name="grp1" value="0" /></lable>        example: 1000000000</li>
        <li><lable>grp2 <input type="text" name="grp2" value="0" /></lable>      example: 400410408001</li>
        <li><lable>grp3 <input type="text" name="grp3" value="0" /></lable>  example: 2000822200008248</li>
        <li><lable>grp4 <input type="text" name="grp4" value="0" /></lable>                 example: 0</li>
        <li><lable>grp5 <input type="text" name="grp5" value="0" /></lable>                 example: 0</li>
        <li><lable>grp6 <input type="text" name="grp6" value="0" /></lable>                 example: 0</li>
        <li><lable>grp7 <input type="text" name="grp7" value="0" /></lable>                 example: 0</li>
    </ul>
    <p style="display:none;"><i style="color:red">look at dev tool console.log </i></p>
    <button>Unpack</button>
</form>



<script>
    $(function(){
        var grpxlib = new GRPX;

        var unpackGRPX =  function(oGRPX){
            allOptions = grpxlib.unpack(oGRPX)
            console.log('UNPACK', '\n', oGRPX, '\n', allOptions);
        }

        // 1) URL string with GRPX
        $('#grpxUnpackUrl').on('submit', function(){
            // get grp from url string
            var resultGrp = {};
            var aFormData = decodeURIComponent($(this).serialize()).split('&');
            for(i in aFormData){
                var param = aFormData[i];
                var patrn = new RegExp("grp[0-7]");
                if( patrn.test(param) ){
                    resultGrp[param.split('=')[0]] = param.split('=')[1]
                }
            }

            // unpack GRP 
            unpackGRPX(resultGrp)

            // show help text
            $('p', $(this)).show();
            return false;
        });


        // 2) Chunks form with GRPX
        $('#grpxUnpackChunk').on('submit', function(){
            // get grp from from inputs
            var resultGrp = {};
            var aFormData = $(this).serializeArray()
            for(i in aFormData){
                var param = aFormData[i];
                resultGrp[param.name] = param.value
            }

            // unpack GRP 
            unpackGRPX(resultGrp)

            // show help text
            $('p', $(this)).show();
            return false;
        });
    })
</script>



</body></html>

